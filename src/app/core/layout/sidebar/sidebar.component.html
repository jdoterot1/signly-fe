<!-- Sidebar container with responsive behavior -->
<div
  [class.w-[68px]]="isCollapsed"
  [class.w-64]="!isCollapsed"
  class="hidden lg:flex flex-col h-full bg-brand-surface-card border-r border-brand-subtle shadow-xl shadow-brand-surface/20 transition-all duration-300"
>
  <!-- Header with logo and collapse button -->
  <div
    class="flex items-center py-4"
    [ngClass]="{
      'justify-between px-3': !isCollapsed,
      'justify-center px-2': isCollapsed
    }"
  >
    <div *ngIf="!isCollapsed" class="flex items-center gap-3 overflow-hidden">
      <div
        [class.h-9]="isCollapsed"
        [class.w-9]="isCollapsed"
        [class.h-11]="!isCollapsed"
        [class.w-11]="!isCollapsed"
        class="rounded-xl bg-brand-primary grid place-content-center text-white text-lg font-bold shrink-0 transition-all duration-300"
      >
        S
      </div>
      <div class="leading-5 transition-opacity duration-300">
        <p class="text-[10px] uppercase tracking-[0.14em] text-brand-muted-light font-semibold">APOLO SUITE</p>
        <p class="text-xl font-extrabold text-brand-ink">Signly</p>
      </div>
    </div>

    <button
      (click)="toggle()"
      class="rounded-full h-8 w-8 shrink-0 grid place-content-center text-brand-muted transition hover:bg-brand-surface-raised hover:text-brand-primary focus:outline-none focus:ring-2 focus:ring-brand-primary"
      [attr.aria-label]="'SIDEBAR.COLLAPSE_MENU' | translate"
    >
      <svg
        *ngIf="!isCollapsed"
        xmlns="http://www.w3.org/2000/svg"
        class="h-4 w-4"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      <svg
        *ngIf="isCollapsed"
        xmlns="http://www.w3.org/2000/svg"
        class="h-4 w-4"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 overflow-y-auto px-3 pb-4 space-y-4 pt-2">

    <div class="space-y-1">
      <p *ngIf="!isCollapsed" class="px-3 text-[10px] uppercase tracking-[0.14em] text-brand-muted-light font-semibold">
        {{ 'SIDEBAR.HOME' | translate }}
      </p>
      <a
        *ngFor="let item of mainSingles"
        [routerLink]="item.path"
        [routerLinkActiveOptions]="activeMatchOptions"
        routerLinkActive="active"
        #rla="routerLinkActive"
        class="group relative flex items-center rounded-lg py-2.5 text-sm font-semibold transition duration-200 ease-in-out"
        [ngClass]="{
          'px-3 gap-3': !isCollapsed,
          'justify-center w-full px-0': isCollapsed,
          'text-brand-primary bg-brand-surface-alt': rla.isActive,
          'text-brand-muted hover:bg-brand-surface-raised': !rla.isActive
        }"
        [attr.title]="isCollapsed ? item.label : null"
      >
        <span
          class="absolute left-0 top-1 bottom-1 w-[3px] rounded-r-full transition-colors duration-200"
          [ngClass]="rla.isActive ? 'bg-brand-primary' : 'bg-transparent'"
        ></span>

        <span
          class="shrink-0 flex items-center justify-center transition-all duration-200"
          [ngClass]="{
            'h-6 w-6': !isCollapsed,
            'h-8 w-8 rounded-lg': isCollapsed
          }"
        >
          <img [src]="item.icon" [alt]="item.label" class="h-5 w-5 opacity-70 group-hover:opacity-100 transition-opacity" />
        </span>

        <span *ngIf="!isCollapsed" class="truncate">{{ item.label | translate }}</span>
      </a>
    </div>

    <div class="space-y-4">
      <p *ngIf="!isCollapsed" class="px-3 text-[10px] uppercase tracking-[0.14em] text-brand-muted-light font-semibold">
        {{ 'SIDEBAR.MAIN_NAV' | translate }}
      </p>

      <div *ngFor="let group of mainGroups" class="rounded-lg">
        <button
          type="button"
          (click)="toggleGroup(group)"
          [attr.aria-expanded]="isGroupOpen(group)"
          class="group relative flex w-full items-center rounded-lg py-2.5 text-sm font-semibold transition duration-200 ease-in-out"
          [ngClass]="{
            'px-3 gap-3': !isCollapsed,
            'justify-center w-full px-0': isCollapsed,
            'text-brand-primary bg-brand-surface-alt': isGroupActive(group),
            'text-brand-muted hover:bg-brand-surface-raised': !isGroupActive(group)
          }"
          [attr.title]="isCollapsed ? group.label : null"
        >
          <span
            class="absolute left-0 top-1 bottom-1 w-[3px] rounded-r-full transition-colors duration-200"
            [ngClass]="isGroupActive(group) ? 'bg-brand-primary' : 'bg-transparent'"
          ></span>

          <span
            class="shrink-0 flex items-center justify-center transition-all duration-200"
            [ngClass]="{
              'h-6 w-6': !isCollapsed,
              'h-8 w-8 rounded-lg': isCollapsed
            }"
          >
            <img [src]="group.icon" [alt]="group.label" class="h-5 w-5 opacity-70 group-hover:opacity-100 transition-opacity" />
          </span>

          <span *ngIf="!isCollapsed" class="flex-1 truncate text-left">{{ group.label | translate }}</span>
          <svg
            *ngIf="!isCollapsed"
            class="h-4 w-4 text-brand-muted-light transition-transform duration-300 shrink-0"
            [ngClass]="isGroupOpen(group) ? 'rotate-180' : ''"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <div *ngIf="isGroupOpen(group) && !isCollapsed" class="mt-1 space-y-0.5 border-l border-brand ml-4 pl-3 py-1">
          <a
            *ngFor="let item of group.children"
            [routerLink]="item.path"
            [routerLinkActiveOptions]="activeMatchOptions"
            routerLinkActive="active"
            #rla="routerLinkActive"
            class="group relative flex items-center rounded-lg py-2 text-sm font-medium pl-3 transition duration-200 ease-in-out"
            [ngClass]="{
              'text-brand-primary font-semibold bg-brand-surface-alt': rla.isActive,
              'text-brand-muted hover:bg-brand-surface-raised': !rla.isActive
            }"
          >
            <span
              class="absolute left-0 top-1 bottom-1 w-[3px] rounded-r-full transition-colors duration-200"
              [ngClass]="rla.isActive ? 'bg-brand-primary' : 'bg-transparent'"
            ></span>

            <span class="flex h-5 w-5 shrink-0 items-center justify-center mr-2">
              <img [src]="item.icon" [alt]="item.label" class="h-4 w-4 opacity-70" />
            </span>
            <span class="truncate">{{ item.label | translate }}</span>
          </a>
        </div>
      </div>
    </div>

    <div class="space-y-4 pt-4 border-t border-brand-subtle">
      <p *ngIf="!isCollapsed" class="px-3 text-[10px] uppercase tracking-[0.14em] text-brand-muted-light font-semibold">
        {{ 'SIDEBAR.SYSTEM_PREFERENCES' | translate }}
      </p>

      <div *ngFor="let group of secondaryGroups" class="rounded-lg">
        <button
          type="button"
          (click)="toggleGroup(group)"
          [attr.aria-expanded]="isGroupOpen(group)"
          class="group relative flex w-full items-center rounded-lg py-2.5 text-sm font-semibold transition duration-200 ease-in-out"
          [ngClass]="{
            'px-3 gap-3': !isCollapsed,
            'justify-center w-full px-0': isCollapsed,
            'text-brand-primary bg-brand-surface-alt': isGroupActive(group),
            'text-brand-muted hover:bg-brand-surface-raised': !isGroupActive(group)
          }"
          [attr.title]="isCollapsed ? group.label : null"
        >
          <span
            class="absolute left-0 top-1 bottom-1 w-[3px] rounded-r-full transition-colors duration-200"
            [ngClass]="isGroupActive(group) ? 'bg-brand-primary' : 'bg-transparent'"
          ></span>
          <span
            class="shrink-0 flex items-center justify-center transition-all duration-200"
            [ngClass]="{
              'h-6 w-6': !isCollapsed,
              'h-8 w-8 rounded-lg': isCollapsed
            }"
          >
            <img [src]="group.icon" [alt]="group.label" class="h-5 w-5 opacity-70 group-hover:opacity-100 transition-opacity" />
          </span>
          <span *ngIf="!isCollapsed" class="flex-1 truncate text-left">{{ group.label | translate }}</span>
          <svg
            *ngIf="!isCollapsed"
            class="h-4 w-4 text-brand-muted-light transition-transform duration-300 shrink-0"
            [ngClass]="isGroupOpen(group) ? 'rotate-180' : ''"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <div *ngIf="isGroupOpen(group) && !isCollapsed" class="mt-1 space-y-0.5 border-l border-brand ml-4 pl-3 py-1">
          <a
            *ngFor="let item of group.children"
            [routerLink]="item.path"
            [routerLinkActiveOptions]="activeMatchOptions"
            routerLinkActive="active"
            #rla="routerLinkActive"
            class="group relative flex items-center rounded-lg py-2 text-sm font-medium pl-3 transition duration-200 ease-in-out"
            [ngClass]="{
              'text-brand-primary font-semibold bg-brand-surface-alt': rla.isActive,
              'text-brand-muted hover:bg-brand-surface-raised': !rla.isActive
            }"
          >
            <span
              class="absolute left-0 top-1 bottom-1 w-[3px] rounded-r-full transition-colors duration-200"
              [ngClass]="rla.isActive ? 'bg-brand-primary' : 'bg-transparent'"
            ></span>
            <span class="flex h-5 w-5 shrink-0 items-center justify-center mr-2">
              <img [src]="item.icon" [alt]="item.label" class="h-4 w-4 opacity-70" />
            </span>
            <span class="truncate">{{ item.label | translate }}</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Logout button -->
  <div class="mt-auto border-t border-brand-subtle bg-brand-surface-card p-3 flex items-center shrink-0">
    <button
      type="button"
      (click)="logout()"
      [disabled]="isLoggingOut"
      class="w-full flex items-center rounded-xl px-2 py-2 text-sm font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed text-rose-700 bg-rose-50 hover:bg-rose-100"
      [ngClass]="{
        'gap-3': !isCollapsed,
        'justify-center w-full': isCollapsed
      }"
      [attr.title]="isCollapsed ? ('SIDEBAR.LOGOUT' | translate) : null"
    >
      <span
        class="flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-brand-surface-card border border-rose-200 text-rose-600 shadow-sm"
        [ngClass]="{'h-8 w-full': isCollapsed}"
      >
        <img src="assets/icons/sidebar/LogOut.svg" alt="Logout" class="h-5 w-5" />
      </span>

      <span *ngIf="!isCollapsed" class="truncate flex-1 text-left">
        <span *ngIf="!isLoggingOut">{{ 'SIDEBAR.LOGOUT' | translate }}</span>
        <span *ngIf="isLoggingOut">{{ 'SIDEBAR.LOGGING_OUT' | translate }}</span>
      </span>
    </button>
  </div>
</div>
