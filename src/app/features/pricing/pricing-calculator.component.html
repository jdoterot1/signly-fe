<div class="min-h-full bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-6xl mx-auto space-y-8">
    <section class="bg-brand-surface-card rounded-3xl border border-brand-subtle shadow px-6 py-8">
      <div class="flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between">
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-brand-primary">{{ 'PRICING.CALCULATOR.TITLE' | translate }}</p>
          <h2 class="text-2xl font-semibold text-gray-900 mt-2">{{ 'PRICING.CALCULATOR.SUBTITLE' | translate }}</h2>
          <p class="text-sm text-gray-600 mt-2 max-w-3xl" [innerHTML]="'PRICING.CALCULATOR.DESCRIPTION' | translate"></p>
        </div>

        <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
          <div class="rounded-2xl border border-brand shadow-sm overflow-hidden">
            <div class="flex bg-brand-surface-alt">
              <button
                type="button"
                class="px-4 py-2 text-sm font-semibold transition"
                [ngClass]="mode === 'credits' ? 'bg-white text-brand-primary shadow-sm' : 'text-brand-muted'"
                (click)="setMode('credits')"
              >
                {{ 'PRICING.CALCULATOR.CREDITS_PREPAID' | translate }}
              </button>
              <button
                type="button"
                class="px-4 py-2 text-sm font-semibold transition"
                [ngClass]="mode === 'ondemand' ? 'bg-white text-brand-primary shadow-sm' : 'text-brand-muted'"
                (click)="setMode('ondemand')"
              >
                {{ 'PRICING.CALCULATOR.ON_DEMAND_POSTPAID' | translate }}
              </button>
            </div>
          </div>

          <button
            type="button"
            class="px-4 py-2 rounded-xl border text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-60"
            (click)="load()"
            [disabled]="isLoading"
          >
            {{ isLoading ? ('PRICING.CALCULATOR.UPDATING' | translate) : ('PRICING.CALCULATOR.UPDATE_PRICES' | translate) }}
          </button>
        </div>
      </div>

      <div class="mt-6 grid lg:grid-cols-3 gap-4">
        <div class="rounded-2xl border border-indigo-100 bg-indigo-50/60 p-5 lg:col-span-2">
          <p class="text-sm text-gray-700 leading-relaxed">
            {{ 'PRICING.CALCULATOR.CREDITS_EXPLANATION' | translate }}
          </p>
        </div>
        <div class="rounded-2xl border border-gray-200 bg-white p-5">
          <p class="text-xs font-semibold uppercase tracking-[0.25em] text-brand-primary">{{ 'PRICING.CALCULATOR.PARAMETERS' | translate }}</p>
          <div class="mt-3 grid grid-cols-2 gap-3">
            <div>
              <label class="text-xs text-gray-500">{{ 'PRICING.CALCULATOR.REGION' | translate }}</label>
              <select
                class="mt-1 w-full rounded-xl border border-gray-300 px-3 py-2 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-brand-accent"
                [(ngModel)]="region"
              >
                <option *ngFor="let r of availableRegions()" [value]="r">{{ r }}</option>
              </select>
            </div>
            <div>
              <label class="text-xs text-gray-500">{{ 'PRICING.CALCULATOR.CURRENCY' | translate }}</label>
              <select
                class="mt-1 w-full rounded-xl border border-gray-300 px-3 py-2 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-brand-accent"
                [(ngModel)]="currency"
              >
                <option *ngFor="let c of availableCurrencies()" [value]="c">{{ c }}</option>
              </select>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-3">
            {{ 'PRICING.CALCULATOR.ESTIMATION_HINT' | translate }}
          </p>
        </div>
      </div>

      <div *ngIf="isLoading" class="mt-6 text-sm text-gray-500 animate-pulse">
        {{ 'PRICING.CALCULATOR.LOADING' | translate }}
      </div>

      <div *ngIf="!isLoading && estimates.length === 0" class="mt-6 text-sm text-gray-500">
        {{ 'PRICING.CALCULATOR.NO_PRICES' | translate }}
      </div>

      <div *ngIf="!isLoading && estimates.length > 0" class="mt-6 grid lg:grid-cols-3 gap-5 items-start">
        <div class="lg:col-span-2 space-y-4 lg:max-h-[70vh] lg:overflow-y-auto lg:pr-2">
          <div
            *ngFor="let item of estimates"
            class="rounded-2xl border border-gray-100 bg-white p-5 shadow-sm"
          >
            <div class="flex flex-col gap-3 md:flex-row md:items-start md:justify-between">
              <div>
                <p class="text-sm font-semibold text-gray-900">{{ item.meter.display_name }}</p>
                <p class="text-xs text-gray-600 mt-1">{{ item.meter.description }}</p>
              </div>
              <div class="text-right">
                <p class="text-xs text-gray-500">{{ 'PRICING.CALCULATOR.CREDITS_PER_DOC' | translate }}</p>
                <p class="text-lg font-semibold text-gray-900 mt-1">
                  {{ creditsPerDoc(item) === null ? 'â€”' : formatNumber(creditsPerDoc(item)!) }}
                </p>
                <p class="text-xs text-gray-500 mt-1">{{ 'PRICING.CALCULATOR.SCALE' | translate: {range: formatTierLabel(tierFor(item))} }}</p>
              </div>
            </div>

            <div class="mt-4 grid md:grid-cols-[1fr_140px] gap-4 items-center">
              <input
                type="range"
                class="w-full accent-brand-primary-medium"
                min="0"
                max="5000"
                step="10"
                [ngModel]="item.qty"
                (ngModelChange)="setQty(item, $event)"
              />

              <div>
                <label class="text-xs text-gray-500">{{ 'PRICING.CALCULATOR.DOCS_PER_MONTH' | translate }}</label>
                <input
                  type="number"
                  min="0"
                  class="mt-1 w-full rounded-xl border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-accent"
                  [ngModel]="item.qty"
                  (ngModelChange)="setQty(item, $event)"
                />
              </div>
            </div>

            <div class="mt-4 flex items-center justify-between text-sm">
              <span class="text-gray-600">{{ 'PRICING.CALCULATOR.MONTHLY_SUBTOTAL' | translate }}</span>
              <span class="font-semibold text-gray-900">{{ formatMoney(subtotalCredits(item), currency) }}</span>
            </div>
          </div>
        </div>

        <aside class="space-y-4 lg:sticky lg:top-24">
          <div class="rounded-2xl border border-gray-200 bg-white p-5">
            <p class="text-xs font-semibold uppercase tracking-[0.25em] text-brand-primary">{{ 'PRICING.CALCULATOR.SUMMARY' | translate }}</p>
            <div class="mt-4 grid gap-3">
              <div class="rounded-2xl bg-gray-50 border border-gray-100 p-4">
                <p class="text-xs text-gray-500">{{ 'PRICING.CALCULATOR.TOTAL_DOCS_MONTH' | translate }}</p>
                <p class="text-xl font-semibold text-gray-900 mt-1">{{ formatNumber(totalDocs) }}</p>
              </div>
              <div class="rounded-2xl bg-gray-50 border border-gray-100 p-4">
                <p class="text-xs text-gray-500">{{ 'PRICING.CALCULATOR.TOTAL_ESTIMATED' | translate }}</p>
                <p class="text-xl font-semibold text-gray-900 mt-1">{{ formatMoney(totalCredits, currency) }}</p>
                <p class="text-xs text-gray-500 mt-1">{{ 'PRICING.CALCULATOR.EQUIVALENT_CREDITS' | translate: {credits: formatNumber(totalCredits)} }}</p>
              </div>
              <div class="rounded-2xl bg-gray-50 border border-gray-100 p-4">
                <p class="text-xs text-gray-500">{{ 'PRICING.CALCULATOR.AVG_PER_DOC' | translate }}</p>
                <p class="text-xl font-semibold text-gray-900 mt-1">{{ avgCreditsPerDoc }}</p>
                <p class="text-xs text-gray-500 mt-1">{{ 'PRICING.CALCULATOR.CREDITS_PER_DOC_ESTIMATED' | translate }}</p>
              </div>
            </div>
          </div>

          <div class="rounded-2xl border border-gray-200 bg-white p-5">
            <p class="text-sm font-semibold text-gray-900">
              {{ mode === 'credits' ? ('PRICING.CALCULATOR.HOW_CREDITS_WORK' | translate) : ('PRICING.CALCULATOR.HOW_ON_DEMAND_WORK' | translate) }}
            </p>
            <p class="text-sm text-gray-600 mt-2 leading-relaxed" *ngIf="mode === 'credits'">
              {{ 'PRICING.CALCULATOR.CREDITS_EXPLANATION_LONG' | translate }}
            </p>
            <p class="text-sm text-gray-600 mt-2 leading-relaxed" *ngIf="mode === 'ondemand'">
              {{ 'PRICING.CALCULATOR.ON_DEMAND_EXPLANATION_LONG' | translate }}
            </p>
          </div>
        </aside>
      </div>
    </section>
  </div>
</div>
