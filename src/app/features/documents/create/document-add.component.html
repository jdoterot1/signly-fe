<!-- src/app/features/documents/create/document-add.component.html -->
<app-guide-modal
  *ngIf="showGuideModal"
  title="Paso 2: crea tu documento"
  subtitle="Carga el archivo y completa los datos para dejarlo listo para firma."
  [steps]="guideSteps"
  primaryLabel="Listo, crear documento"
  secondaryLabel="Cerrar"
  (primary)="startDocumentStep()"
  (closed)="closeGuideModal()"
></app-guide-modal>

<app-form
  [config]="formConfig"
  [form]="form"
  [initialData]="formInitialValues"
  [extraTemplate]="participantsTemplate"
  [submitLabel]="submitLabel"
  [cancelLabel]="cancelLabel"
  (submitForm)="onSubmit($event)"
  (cancelForm)="onCancel()"
></app-form>

<ng-template #participantsTemplate>
  <section *ngIf="currentStep === 2" class="space-y-4">
    <div class="flex items-center justify-between gap-3">
      <h3 class="text-base font-semibold text-gray-800">
        Participantes agregados ({{ participantsDraft.length }})
      </h3>
      <button
        type="button"
        class="px-4 py-2 text-sm font-semibold text-white bg-brand-primary hover:bg-brand-primary-hover rounded-xl shadow transition"
        (click)="addParticipant()"
      >
        Agregar participante
      </button>
    </div>

    <p *ngIf="!participantsDraft.length" class="text-sm text-gray-500">
      Completa los datos del participante y haz clic en "Agregar participante".
    </p>

    <div class="space-y-3" *ngIf="participantsDraft.length">
      <article
        *ngFor="let participant of participantsDraft; let i = index"
        class="border border-gray-200 rounded-xl p-4 bg-white"
      >
        <div class="flex items-start justify-between gap-4">
          <div class="space-y-1 text-sm text-gray-700">
            <p class="font-semibold text-gray-900">{{ participant.displayName }}</p>
            <p *ngIf="participant.identity.email">Email: {{ participant.identity.email }}</p>
            <p *ngIf="participant.identity.phone">Tel√©fono: {{ participant.identity.phone }}</p>
            <p *ngIf="participant.identity.documentNumber">Documento: {{ participant.identity.documentNumber }}</p>
            <p>Modos: {{ participant.signatureMode.join(', ') }}</p>
          </div>
          <button
            type="button"
            class="px-3 py-1.5 text-xs font-semibold text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition"
            (click)="removeParticipant(i)"
          >
            Eliminar
          </button>
        </div>
      </article>
    </div>
  </section>
</ng-template>
