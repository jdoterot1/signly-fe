<section class="space-y-6">
  <header class="bg-white shadow rounded-xl p-6">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div>
        <p class="text-sm uppercase tracking-wide text-indigo-500 font-semibold">
          Mapeador de documentos
        </p>
        <h1 class="text-2xl font-semibold text-gray-900">Sube, convierte y edita tus plantillas</h1>
        <p class="text-gray-500 mt-2">
          Carga un archivo Word (.docx) o PDF, ed√≠talo directamente en el navegador y reutiliza el contenido como plantilla.
        </p>
      </div>
      <div class="flex flex-wrap gap-3">
        <button
          type="button"
          (click)="downloadHtml()"
          [disabled]="!selectedFile"
          class="px-4 py-2 rounded-lg border border-indigo-600 text-indigo-600 hover:bg-indigo-50 disabled:opacity-40 disabled:cursor-not-allowed"
        >
          Descargar como HTML
        </button>
        <button
          type="button"
          (click)="clearDocument()"
          class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50"
        >
          Limpiar
        </button>
      </div>
    </div>
  </header>

  <article class="bg-white rounded-xl shadow p-6">
    <label
      class="flex flex-col items-center justify-center border-2 border-dashed rounded-xl py-10 cursor-pointer transition"
      [class.border-indigo-400]="dragActive"
      [class.bg-indigo-50]="dragActive"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
    >
      <input type="file" class="hidden" accept=".docx,.pdf" (change)="onFileSelected($event)" />
      <div class="text-center space-y-3">
        <div class="text-4xl">üìÑ</div>
        <p class="text-lg font-medium text-gray-900">
          Arrastra tu documento aqu√≠ o <span class="text-indigo-600 underline">haz clic para seleccionarlo</span>
        </p>
        <p class="text-sm text-gray-500">Formatos soportados: Word (.docx) y PDF (el PDF se convertir√° a texto editable)</p>
      </div>
    </label>

    <div class="mt-6" *ngIf="selectedFile">
      <div class="flex flex-wrap items-center gap-4">
        <div>
          <p class="text-sm text-gray-500">Archivo seleccionado</p>
          <p class="font-semibold text-gray-900">{{ selectedFile.name }}</p>
        </div>
        <div class="text-sm text-gray-500">
          {{ (selectedFile.size / 1024 / 1024) | number:'1.1-2' }} MB ¬∑ {{ selectedFile.type || 'Formato detectado' }}
        </div>
      </div>
      <div class="mt-4 grid gap-3 text-sm text-gray-600" *ngIf="metadata as info">
        <div class="flex flex-wrap gap-2">
          <span class="px-3 py-1 rounded-full bg-indigo-100 text-indigo-700 capitalize">
            {{ info.type === 'docx' ? 'Word' : 'PDF' }}
          </span>
          <span *ngIf="info.pages">{{ info.pages }} p√°ginas ¬∑</span>
          <span *ngIf="info.paragraphs">{{ info.paragraphs }} p√°rrafos detectados</span>
        </div>
      </div>
      <ul
        *ngIf="conversionWarnings.length"
        class="mt-4 space-y-2 bg-amber-50 border border-amber-200 rounded-lg p-4 text-amber-800 text-sm"
      >
        <li *ngFor="let warning of conversionWarnings">‚ö†Ô∏è {{ warning }}</li>
      </ul>
    </div>

    <p *ngIf="errorMessage" class="mt-4 text-sm text-red-600">{{ errorMessage }}</p>
    <p *ngIf="loading" class="mt-4 text-sm text-gray-500">Procesando documento‚Ä¶</p>
  </article>

  <section *ngIf="selectedFile" class="grid gap-6 lg:grid-cols-[2fr_1fr]">
    <div class="space-y-6">
      <div class="bg-white rounded-xl shadow p-6 flex flex-col">
        <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between mb-4">
          <div>
            <p class="text-sm uppercase text-indigo-500 font-semibold">Editor</p>
            <h2 class="text-xl font-semibold text-gray-900">Contenido editable</h2>
          </div>
          <div class="w-full lg:w-64">
            <label class="text-xs uppercase text-gray-500">Nombre de la plantilla</label>
            <input
              type="text"
              class="mt-1 w-full rounded-lg border-gray-200 focus:border-indigo-500 focus:ring-indigo-500"
              [formControl]="form.controls.documentName"
              placeholder="Ej. Contrato_comercial"
            />
          </div>
        </div>
        <div
          class="flex-1 border rounded-xl overflow-hidden editor-container"
          [class.editor-drop-active]="editorDropActive"
          (dragover)="onEditorDragOver($event)"
          (dragleave)="onEditorDragLeave($event)"
          (drop)="onEditorDrop($event)"
        >
          <div #quillEditor class="h-full"></div>
        </div>
        <p class="text-sm text-gray-500 mt-3 flex items-center gap-2">
          <span class="text-indigo-500 text-base">‚á¢</span>
          Arrastra campos desde la paleta o haz clic para insertarlos como placeholders.
        </p>
      </div>

      <div class="bg-white rounded-xl shadow p-6">
        <p class="text-sm uppercase text-gray-500 font-semibold">Vista previa instant√°nea</p>
        <h2 class="text-xl font-semibold text-gray-900 mb-4">HTML resultante</h2>
        <div class="preview border rounded-xl p-4 overflow-y-auto">
          <div
            class="prose max-w-none"
            [innerHTML]="previewHtml || '<p class=\'text-gray-400\'>Sin contenido</p>'"
          ></div>
        </div>
      </div>
    </div>

    <div class="space-y-6">
      <div class="bg-white rounded-xl shadow p-6 sticky top-28">
        <p class="text-sm uppercase text-gray-500 font-semibold">Paleta de campos</p>
        <h2 class="text-xl font-semibold text-gray-900">Drag & Drop</h2>
        <p class="text-sm text-gray-500 mb-4">
          Arrastra los campos al editor para crear marcadores de posici√≥n editables.
        </p>

        <div class="space-y-2">
          <button
            *ngFor="let field of fieldPalette"
            type="button"
            class="w-full text-left px-3 py-2 rounded-xl border border-gray-200 bg-white hover:bg-indigo-50 hover:border-indigo-200 shadow-[0_1px_0_#edeef2] transition cursor-grab active:scale-[0.99]"
            draggable="true"
            (dragstart)="onPaletteDragStart($event, field.type)"
            (dragend)="onPaletteDragEnd()"
            (click)="onPaletteClick(field.type)"
          >
            <div class="flex items-center justify-between">
              <span class="font-medium text-gray-900">{{ field.label }}</span>
              <span class="text-[11px] uppercase tracking-wide text-gray-400">{{ field.type }}</span>
            </div>
            <p class="text-xs text-gray-500 mt-1" *ngIf="field.description">{{ field.description }}</p>
          </button>
        </div>

        <p class="text-xs text-gray-400 mt-4">
          Los placeholders se insertan con el formato <span class="font-mono text-indigo-600">{{ '{{CAMPO}}' }}</span>.
        </p>
      </div>
    </div>
  </section>
</section>
