<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/40 to-indigo-50/30 relative overflow-hidden">
  <div class="absolute -top-32 -right-24 h-72 w-72 rounded-full bg-blue-200/40 blur-3xl"></div>
  <div class="absolute -bottom-24 -left-16 h-64 w-64 rounded-full bg-indigo-200/40 blur-3xl"></div>

  <header class="relative z-10 flex items-center justify-between px-6 py-5">
    <div class="flex items-center gap-3">
      <img src="assets/icons/sidebar/ApoloLogo.svg" alt="Signly" class="h-8 w-8" />
      <span class="text-sm font-semibold text-slate-700">Signly</span>
    </div>
    <button class="text-xs font-semibold text-slate-500 hover:text-slate-700 transition" type="button">
      Necesitas ayuda?
    </button>
  </header>

  <main class="relative z-10 flex items-center justify-center px-4 py-10">
    <section class="w-full max-w-lg rounded-3xl bg-white/80 backdrop-blur-xl border border-white shadow-2xl shadow-blue-100/60 p-8 md:p-12">

      <!-- Intro Step -->
      <div *ngIf="currentStep === 'intro'" class="flex flex-col items-center text-center gap-6">
        <div class="w-20 h-20 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center shadow-lg">
          <i class="pi pi-video text-3xl text-white"></i>
        </div>

        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.35em] text-green-600">Verificacion</p>
          <h1 class="mt-3 text-2xl md:text-3xl font-semibold text-slate-900">Prueba de vida</h1>
          <p class="mt-3 text-sm text-slate-500 max-w-sm">
            Necesitamos verificar que eres una persona real. Sigue las instrucciones en pantalla.
          </p>
        </div>

        <div class="grid gap-3 text-left w-full">
          <div class="flex items-start gap-3 rounded-2xl border border-slate-100 bg-slate-50/80 p-4">
            <span class="mt-1 h-2 w-2 rounded-full bg-green-500"></span>
            <p class="text-xs text-slate-600">Asegurate de estar en un lugar bien iluminado</p>
          </div>
          <div class="flex items-start gap-3 rounded-2xl border border-slate-100 bg-slate-50/80 p-4">
            <span class="mt-1 h-2 w-2 rounded-full bg-green-500"></span>
            <p class="text-xs text-slate-600">Mira directamente a la camara durante todo el proceso</p>
          </div>
          <div class="flex items-start gap-3 rounded-2xl border border-slate-100 bg-slate-50/80 p-4">
            <span class="mt-1 h-2 w-2 rounded-full bg-green-500"></span>
            <p class="text-xs text-slate-600">Sigue las instrucciones que apareceran en pantalla</p>
          </div>
        </div>

        <button (click)="startLiveness()"
                [disabled]="loading"
                class="rounded-full bg-green-600 px-8 py-3 text-sm font-semibold text-white shadow-lg shadow-green-200/60 hover:bg-green-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
          <i *ngIf="loading" class="pi pi-spin pi-spinner"></i>
          {{ loading ? 'Preparando...' : 'Comenzar prueba' }}
          <i *ngIf="!loading" class="pi pi-arrow-right text-xs"></i>
        </button>
      </div>

      <!-- Preparing Step -->
      <div *ngIf="currentStep === 'preparing'" class="flex flex-col items-center text-center gap-6">
        <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center">
          <i class="pi pi-spin pi-spinner text-2xl text-green-600"></i>
        </div>
        <div>
          <h1 class="text-xl font-semibold text-slate-900">Preparando camara</h1>
          <p class="mt-2 text-sm text-slate-500">Iniciando la prueba de vida...</p>
        </div>
      </div>

      <!-- Active Step (Camera with instructions) -->
      <div *ngIf="currentStep === 'active'" class="flex flex-col items-center text-center gap-6">
        <!-- Progress bar -->
        <div class="w-full">
          <div class="flex items-center justify-between mb-2">
            <span class="text-xs text-slate-500">Progreso</span>
            <span class="text-xs font-semibold text-green-600">{{ getProgress() }}%</span>
          </div>
          <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
            <div class="h-full bg-green-500 transition-all duration-300"
                 [style.width.%]="getProgress()"></div>
          </div>
        </div>

        <!-- Camera View -->
        <div class="relative w-full max-w-xs">
          <div class="aspect-square overflow-hidden rounded-full border-4 border-green-200 bg-slate-900 shadow-lg">
            <video #video
                   autoplay
                   playsinline
                   muted
                   class="w-full h-full object-cover scale-x-[-1]"></video>
          </div>

          <!-- Animated ring -->
          <div class="absolute inset-0 rounded-full border-4 border-green-400 animate-pulse"></div>
        </div>

        <!-- Current Instruction -->
        <div class="bg-green-50 border border-green-200 rounded-2xl p-4 w-full">
          <div class="flex items-center justify-center gap-3">
            <i class="pi text-xl text-green-600" [ngClass]="getCurrentInstructionIcon()"></i>
            <span class="text-sm font-medium text-green-700">{{ currentInstruction }}</span>
          </div>
        </div>

        <!-- Camera Error -->
        <div *ngIf="cameraError" class="bg-red-50 border border-red-200 rounded-2xl p-4 w-full">
          <p class="text-sm text-red-600">{{ cameraError }}</p>
        </div>
      </div>

      <!-- Processing Step -->
      <div *ngIf="currentStep === 'processing'" class="flex flex-col items-center text-center gap-6">
        <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center">
          <i class="pi pi-spin pi-spinner text-2xl text-green-600"></i>
        </div>
        <div>
          <h1 class="text-xl font-semibold text-slate-900">Procesando</h1>
          <p class="mt-2 text-sm text-slate-500">Verificando prueba de vida...</p>
        </div>
        <div class="flex items-center gap-2 text-sm text-slate-400">
          <i class="pi pi-lock"></i>
          <span>Proceso seguro y encriptado</span>
        </div>
      </div>

      <!-- Success Step -->
      <div *ngIf="currentStep === 'success'" class="flex flex-col items-center text-center gap-6">
        <div class="w-20 h-20 rounded-full bg-green-100 flex items-center justify-center">
          <i class="pi pi-check text-3xl text-green-600"></i>
        </div>
        <div>
          <h1 class="text-2xl font-semibold text-slate-900">Prueba completada</h1>
          <p class="mt-2 text-sm text-slate-500">Has completado la prueba de vida exitosamente.</p>
        </div>
        <p class="text-sm text-slate-400">Redirigiendo al siguiente paso...</p>
      </div>

      <!-- Error Step -->
      <div *ngIf="currentStep === 'error'" class="flex flex-col items-center text-center gap-6">
        <div class="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center">
          <i class="pi pi-times text-2xl text-red-600"></i>
        </div>
        <div>
          <h1 class="text-xl font-semibold text-slate-900">Error</h1>
          <p class="mt-2 text-sm text-slate-500">{{ error || 'No pudimos completar la prueba de vida.' }}</p>
        </div>

        <div class="bg-amber-50 border border-amber-200 rounded-2xl p-4 w-full text-left">
          <p class="text-xs text-amber-700">
            <strong>Consejos:</strong>
          </p>
          <ul class="mt-2 text-xs text-amber-600 space-y-1 list-disc list-inside">
            <li>Asegurate de tener buena iluminacion</li>
            <li>Evita movimientos bruscos</li>
            <li>Mira directamente a la camara</li>
            <li>Revisa los permisos de la camara</li>
          </ul>
        </div>

        <button (click)="retry()"
                class="rounded-full bg-green-600 px-8 py-3 text-sm font-semibold text-white shadow-lg shadow-green-200/60 hover:bg-green-700 flex items-center gap-2">
          <i class="pi pi-refresh text-xs"></i>
          Intentar de nuevo
        </button>
      </div>

    </section>
  </main>
</div>
